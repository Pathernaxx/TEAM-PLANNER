<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.teamplanner.mapper.BoardMapper">
 
 <resultMap id="BoardResult" type="Board" >
 	<id column="no" property="no" />
 	<result column="name" property="name" />
 	<result column="regdate" property="regdate" 
 		typeHandler="com.teamplanner.handler.DataFormatHandler"/>
 	<result column="visibility" property="visibility" />
 	<result column="closed" property="closed" />
 	<result column="position" property="position" />
 	<collection column="no" property="boardlist" ofType="BoardList" select="selectBoardList" /> 
 </resultMap>
 
 <resultMap id="BoardListResult" type="BoardList">
 	<id column="no" property="no" />
 	<result column="boardno" property="boardNo" />
 	<result column="name" property="name" />
 	<result column="regdate" property="regDate" />
 	<result column="position" property="position" />
 	<result column="archived" property="archived" />
 	<collection column="no" property="cards" ofType="Card" select="selectCard" />
 </resultMap>
 
 <resultMap id="CardResult" type="Card" >
 	<id column="no" property="no" />
 	<result column="name" property="name" />
 	<result column="regdate" property="regDate" 
 		typeHandler="com.teamplanner.handler.DataFormatHandler"/>
 	<result column="listno" property="listNo" />
 	<result column="boardno" property="boardNo" />
 	<result column="boardname" property="boardName" />
 	<result column="position" property="position" />
 	<result column="duedate" property="dueDate" />
 	<result column="archived" property="archived" />
 	<result column="deleted" property="deleted" />
 </resultMap>
 
 <!-- 유정 -->
 	<select id="selectBoardByList" parameterType="int" resultMap="BoardResult">
 		SELECT no, name, regdate, visibility, closed
 		FROM board
 		WHERE no = #{boardNo}
 	</select>
 	
 	<select id="selectBoardList" parameterType="int" resultMap="BoardListResult">
 		SELECT no, boardno, name, regdate, position, archived
 		FROM boardlist
 		WHERE boardno = #{no}
 	</select>
 	
 	<select id="selectCard" parameterType="int" resultMap="CardResult">
 		SELECT no, name, listno, boardno, boardname, position, duedate, archived, deleted
 		FROM boardcard
 		WHERE listno = #{listno}
 	</select>
 	
 	<insert id="insertCard" parameterType="Card">
 		INSERT INTO boardcard(no, name, listno, boardno, boardname, position)
 		VALUES (boardcard_sequence, #{name}, #{listno}, #{boardno}, #{boardname}, #{position})
 	</insert>
 	
 	<!-- <insert id="insertList" parameterType="hashMap">
 		INSERT INTO boardlist(no, boardno, name, position)
 		VALUES (boardlist_sequence.nextval, #{boardno}, #{listname}, #{position})
 	</insert> -->
 	<insert id="insertBoardList" parameterType="BoardList">
 		INSERT INTO boardlist(no, boardno, name, position)
 		VALUES (boardlist_sequence.nextval, #{boardNo}, #{name}, #{position})
 	</insert>
 	
 
 <!-- 동윤 -->
 	<insert id="insertBoard" parameterType="String">
 		INSERT INTO board(no, name) VALUES (board_sequence.nextval , #{name})
 	</insert>
 	
 	<select id="getBoardNo" parameterType="String" resultType="int">
 		SELECT no FROM board WHERE name = #{name}
 	</select>
 	
 	<insert id="insertTeamList" parameterType="hashMap">
 		INSERT INTO teamlist(no, memberno, boardno, usertype) 
 		VALUES (teamlist_sequence.nextval , #{memberNo} , #{boardNo} , 0 )
 	</insert>
 	
 	<select id="selectBoardbyTeamList" parameterType="Integer" resultType="Board">
 		SELECT b.* 
 		FROM teamlist t, board b 
 		WHERE t.memberno = #{memberNo} AND t.boardno = b.no AND b.closed = '0' 
 		ORDER BY b.name
 	</select>
 	
 	<select id="checkBoardName" parameterType="String" resultType="String">
 		SELECT name FROM board WHERE name = #{title}
 	</select>
 	
 	<select id="selectClosedBoard" parameterType="Integer" resultType="Board">
 		SELECT b.* 
 		FROM teamlist t, board b 
 		WHERE t.memberno = #{memberNo} AND t.boardno = b.no AND b.closed = '1' 
 		ORDER BY b.name
 	</select>
 	
 </mapper>
 
 
 
 
 
 
